name: Build ISO
on: [push, workflow_dispatch]
jobs:
  archiso:
    runs-on: ubuntu-latest
    container:
      image: archlinux:latest
      options: --privileged
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup and Build
        - name: Setup and Build
        run: |
          # 1. Инициализация ключей pacman
          pacman-key --init
          pacman-key --populate archlinux
          
          # 2. Обновление и установка инструментов
          pacman -Syu --noconfirm archiso
          
          # 3. Создание нужных директорий (важно!)
          mkdir -p airootfs/etc/systemd/system/display-manager.service.wants
          mkdir -p airootfs/etc/systemd/system/multi-user.target.wants
          
          # 4. Создание символических ссылок
          ln -sf /usr/lib/systemd/system/sddm.service airootfs/etc/systemd/system/display-manager.service
          ln -sf /usr/lib/systemd/system/NetworkManager.service airootfs/etc/systemd/system/multi-user.target.wants/NetworkManager.service
          
          # 5. Сборка
          mkarchiso -v -w /tmp/archiso-tmp -o ./out .
      - name: Upload ISO
        uses: actions/upload-artifact@v4
        with:
          name: Arch-KDE-Live
          path: out/*.iso
